<window width="1056" height="520" title="Editing Sprite">
	<set name="XOFFSET" value="50" />
	<set name="YOFFSET" value="40" />
	<set name="TO" value="64" />

	<exec>
		previewSprite =  new FunkinSprite(50, self.winHeight - 100);
		previewSprite.frame = sprite.frame;

		self.add(previewSprite);
	</exec>

	<title name="title" x="20" y="30 + 16" text="Sprite Data" />

	<set name="curY" value="title.y + TO" /> <!-- ROW 1 -->

	<textbox name="nameTextBox" label="Name Identifier" text="${data.getName()}"   x="20" y="curY" width="200" height="32" />
	<textbox name="spriteTextBox" label="Image File (${stage.spritesParentFolder})" text="${getEx('imageFile')}"   x="last.x + last.bWidth + XOFFSET" y="curY" width="200" height="32" />

	<set name="curY" value="nameTextBox.y + nameTextBox.bHeight + YOFFSET" /> <!-- ROW 2 -->

	<stepper name="xStepper" label="X" value="sprite.x" x="20" y="curY" step="1" width="100" />
	<stepper name="yStepper" label="Y" value="sprite.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" step="1" width="100" />

	<stepper name="scrollXStepper" label="Scroll X" value="sprite.scrollFactor.x" x="spriteTextBox.x" y="curY" precision="2" step="0.01" width="100" />
	<stepper name="scrollYStepper" label="Scroll Y" value="sprite.scrollFactor.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

	<stepper name="scaleXStepper" label="Scale X" value="sprite.scale.x" x="20 + (200 + XOFFSET) * 2" y="curY" precision="2" step="0.01" width="100" />
	<stepper name="scaleYStepper" label="Scale Y" value="sprite.scale.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

	<set name="curY" value="xStepper.y + xStepper.bHeight + YOFFSET" /> <!-- ROW 3 -->

	<stepper name="angleStepper" label="Angle" value="sprite.angle" x="20 + (200 + XOFFSET) * 0" y="curY" precision="2" step="0.01" width="100" />
	<stepper name="zoomFactorStepper" label="Zoom Factor" value="sprite.zoomFactor" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

	<stepper name="skewXStepper" label="Skew X" value="sprite.skew.x" x="20 + (200 + XOFFSET) * 2" y="curY" precision="2" step="0.01" width="100" />
	<stepper name="skewYStepper" label="Skew Y" value="sprite.skew.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

	<!-- TODO: Simplify this -->
	<dropdown name="animType" label="Animation Type" value="sprite.spriteAnimType" x="20 + (200 + XOFFSET) * 1" y="curY" width="150" height="32">
		<item label="NONE" value="0" />
		<item label="BEAT" value="1" />
		<item label="LOOP" value="2" />
	</dropdown>

	<!-- ROW 4 -->
	<set name="curY" value="angleStepper.y + angleStepper.bHeight + YOFFSET" />

	<checkbox name="antialiasingCheckbox" text="Antialiasing" value="sprite.antialiasing" x="20 + (200 + XOFFSET) * 0" y="curY" />
	<radio for="memoryCheck" name="highMemoryRadio" text="High Memory Only" value="getEx('highMemory')" x="20 + (200 + XOFFSET) * 1" y="curY" />
	<radio for="memoryCheck" name="lowMemoryRadio" text="Low Memory Only" value="getEx('lowMemory')" x="20 + (200 + XOFFSET) * 2" y="curY" />

	<!-- TODO: Animation list -->


	<!-- Preview Transform -->

	<title name="previewTitle" x="20" y="self.winHeight - 150" text="Preview Transform:" size="14" />

	<exec>
		function onUpdate() {
			previewSprite.color = 0xFFFFFFFF;
			previewSprite.skew.x = skewXStepper.value;
			previewSprite.skew.y = skewYStepper.value;
			previewSprite.angle = angleStepper.value;
			previewSprite.antialiasing = antialiasingCheckbox.checked;
			var ratio = sprite.width / sprite.height;
			previewSprite.setGraphicSize(50 * scaleXStepper.value * ratio, 50 * scaleYStepper.value);
			previewSprite.updateHitbox();
		}

		function onSave() {
			sprite.name = nameTextBox.label.text;
			setEx("imageFile", spriteTextBox.label.text);

			setEx("highMemory", highMemoryRadio.checked);
			setEx("lowMemory", lowMemoryRadio.checked);

			sprite.x = xStepper.value;
			sprite.y = yStepper.value;
			sprite.zoomFactor = zoomFactorStepper.value;
			sprite.antialiasing = antialiasingCheckbox.checked;
			//sprite.color = colorWheel.color;
			sprite.spriteAnimType = animType.value;
			sprite.angle = angleStepper.value;

			function saveXY(obj:Dynamic, name:String, x:UINumericStepper, y:UINumericStepper) {
				data.xml.remove(name + "");
				data.xml.remove(name + "x");
				data.xml.remove(name + "y");

				obj.x = x.value;
				obj.y = y.value;

				if(x.value == y.value)
					data.xml.set(name, x.value);
				else {
					data.xml.set(name + "x", x.value);
					data.xml.set(name + "y", y.value);
				}
			}

			data.xml.set("name", nameTextBox.label.text);
			data.xml.set("sprite", spriteTextBox.label.text);
			data.xml.set("x", xStepper.value);
			data.xml.set("y", yStepper.value);
			data.xml.set("zoom", zoomFactorStepper.value);
			data.xml.set("type", animType.key);
			data.xml.set("antialiasing", antialiasingCheckbox.checked);
			data.xml.set("angle", angleStepper.value);

			saveXY(sprite.scrollFactor, "scroll", scrollXStepper, scrollYStepper);
			saveXY(sprite.scale, "scale", scaleXStepper, scaleYStepper);
			saveXY(sprite.skew, "skew", skewXStepper, skewYStepper);
		}
	</exec>
</window>