<window width="550" height="570" title="Editing Character ${button.getName()}">
	<set name="XOFFSET" value="30" />
	<set name="YOFFSET" value="40" />
	<set name="TO" value="64" />

	<exec>
		function col(c:Int) {
			return 20 + (150 + XOFFSET) * c;
		}
		previewSprite = null;
		if(char.animateAtlas == null) {
			previewSprite = new FunkinSprite(0, 0);
			previewSprite.frame = char.frame;

			self.add(previewSprite);
		}
	</exec>

	<title name="title" x="20" y="30 + 16" text="Character Data" />

	<section>
		<set name="curY" value="title.y + TO" />

		<stepper name="xStepper" label="X" value="charPos.x" x="col(0)" y="curY" step="1" width="100" />
		<stepper name="yStepper" label="Y" value="charPos.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" step="1" width="100" />

		<stepper name="scrollXStepper" label="Scroll X" value="charPos.scrollFactor.x" x="col(1)" y="curY" precision="2" step="0.01" width="100" />
		<stepper name="scrollYStepper" label="Scroll Y" value="charPos.scrollFactor.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

		<stepper name="scaleXStepper" label="Scale X" value="charPos.scale.x" x="col(2)" y="curY" precision="2" step="0.01" width="100" />
		<stepper name="scaleYStepper" label="Scale Y" value="charPos.scale.y" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />
	</section>

	<section>
		<set name="curY" value="xStepper.y + xStepper.bHeight + YOFFSET" />

		<stepper name="camxStepper" label="Cam X" value="charPos.camxoffset" x="col(0)" y="curY" step="1" width="100" />
		<stepper name="camyStepper" label="Cam Y" value="charPos.camyoffset" x="last.x + last.bWidth + XOFFSET - 20" y="curY" step="1" width="100" />

		<stepper name="skewXStepper" label="Skew X" value="charPos.skewX" x="col(1)" y="curY" precision="2" step="0.01" width="100" />
		<stepper name="skewYStepper" label="Skew Y" value="charPos.skewY" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

		<label name="spacingLabel" text="Spacing (X, Y)" x="col(2)" y="curY" size="15" />
		<stepper name="spacingXStepper" value="charPos.charSpacingX" x="col(2)" y="curY" precision="2" step="0.01" width="100" />
		<stepper name="spacingYStepper" value="charPos.charSpacingY" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />
	</section>

	<section>
		<set name="curY" value="camxStepper.y + camxStepper.bHeight + YOFFSET" />

		<stepper name="alphaStepper" label="Alpha" value="charPos.alpha" x="col(0)" y="curY" precision="2" step="0.01" width="100" />
		<stepper name="angleStepper" label="Angle" value="charPos.angle" x="last.x + last.bWidth + XOFFSET - 20" y="curY" precision="2" step="0.01" width="100" />

		<stepper name="zoomFactorStepper" label="Zoom Factor" value="charPos.zoomFactor" x="col(1)" y="curY" precision="2" step="0.01" width="100" />
	</section>

	<section>
		<set name="curY" value="alphaStepper.y + alphaStepper.bHeight + YOFFSET - 20" />

		<checkbox name="flipXCheckbox" text="Flip X" value="charPos.flipX" x="col(0)" y="curY" />

		<radio for="memoryCheck" name="highMemoryRadio" text="High Memory Only" value="getEx('highMemory')" x="last.field.x + last.field.width + XOFFSET * 2" y="curY" />
		<radio for="memoryCheck" name="lowMemoryRadio" text="Low Memory Only" value="getEx('lowMemory')" x="last.field.x + last.field.width + XOFFSET * 2" y="curY" />
	</section>

	<section if="previewSprite != null">
		<title name="previewTitle" x="20" y="self.winHeight - 220" text="Preview Transform:" size="15" />
	</section>
	<section if="previewSprite == null">
		<exec>
			self.windowSpr.bHeight -= 170;
		</exec>
	</section>

	<exec>
		function onUpdate() {
			if(previewSprite == null) return;
			previewSprite.skew.x = skewXStepper.value;
			previewSprite.skew.y = skewYStepper.value;
			previewSprite.angle = angleStepper.value;
			previewSprite.antialiasing = char.antialiasing;
			var ratio = char.frameWidth / char.frameHeight;
			previewSprite.setGraphicSize(145 * scaleXStepper.value * ratio, 145 * scaleYStepper.value);
			previewSprite.updateHitbox();
			if(flipXCheckbox.checked != (charPos.name == "boyfriend"))
				previewSprite.scale.x *= -1;

			previewSprite.x = 30;
			previewSprite.y = self.winHeight - previewSprite.height - 30;
		}

		function onSave() {
			setEx("highMemory", highMemoryRadio.checked);
			setEx("lowMemory", lowMemoryRadio.checked);

			charPos.x = xStepper.value;
			charPos.y = yStepper.value;
			charPos.scrollFactor.set(scrollXStepper.value, scrollYStepper.value);
			charPos.scale.set(scaleXStepper.value, scaleYStepper.value);
			charPos.camxoffset = camxStepper.value;
			charPos.camyoffset = camyStepper.value;
			charPos.skewX = skewXStepper.value;
			charPos.skewY = skewYStepper.value;
			charPos.alpha = alphaStepper.value;
			charPos.charSpacingX = spacingXStepper.value;
			charPos.charSpacingY = spacingYStepper.value;
			charPos.flipX = flipXCheckbox.checked;
			charPos.zoomFactor = zoomFactorStepper.value;
			charPos.angle = angleStepper.value;

			charPos.revertCharacter(char);
			charPos.prepareCharacter(char, charPos._id);
		}
	</exec>
</window>